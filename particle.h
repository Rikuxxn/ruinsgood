//=============================================================================
//
// パーティクル処理 [particle.h]
// Author : RIKU TANEKAWA
//
//=============================================================================
#ifndef _PARTICLE_H_// このマクロ定義がされていなかったら
#define _PARTICLE_H_// 2重インクルード防止のマクロ定義

//*****************************************************************************
// インクルードファイル
//*****************************************************************************
#include "main.h"
#include "effect.h"
#include <unordered_map>
#include <functional>

class CParticle;

using ParticleCreateFunc = std::function<CParticle* ()>;

//*****************************************************************************
// パーティクルクラス
//*****************************************************************************
class CParticle : public CEffect
{
public:
	CParticle();
	~CParticle();

	// パーティクルの種類
	typedef enum
	{
		TYPE_FIRE = 0,
		TYPE_FLAMETHROWER,
		TYPE_WATER,
		TYPE_AURA,
		TYPE_AURA2,
		TYPE_MOVE,
		TYPE_MAX
	}TYPE;

	static CParticle* Create(D3DXVECTOR3 dir, D3DXVECTOR3 pos, D3DXCOLOR col, int nLife, TYPE type, int nMaxParticle);
	static void InitFactory(void);
	HRESULT Init(void);
	void Update(void);

	void SetParticle(TYPE type) { m_nType = type; }
	void SetLife(int nLife) { m_nLife = nLife; }
	void SetDir(D3DXVECTOR3 dir) { m_Dir = dir; }

	int GetLife(void) { return m_nLife; }
	int GetMaxParticle(void) { return m_nMaxParticle; }
	D3DXVECTOR3 GetDir(void) { return m_Dir; }

private:
	D3DXVECTOR3 m_Dir;	// 方向
	TYPE m_nType;		// 種類
	int m_nLife;		// 寿命
	int m_nMaxParticle;	// 粒子の数
	static std::unordered_map<TYPE, ParticleCreateFunc> m_ParticleFactoryMap;
};

//*****************************************************************************
// 炎パーティクルクラス
//*****************************************************************************
class CFireParticle : public CParticle
{
public:
	CFireParticle();
	~CFireParticle();

	HRESULT Init(void);
	void Update(void);

private:

};

//*****************************************************************************
// 火炎放射パーティクルクラス
//*****************************************************************************
class CFlamethrowerParticle : public CParticle
{
public:
	CFlamethrowerParticle();
	~CFlamethrowerParticle();

	HRESULT Init(void);
	void Update(void);

	void SetSpeedScale(float scale) { m_speedScale = scale; }
	float GetSpeedScale() const { return m_speedScale; }

private:
	float m_speedScale;  // 速度倍率
};

//*****************************************************************************
// 水しぶきパーティクルクラス
//*****************************************************************************
class CWaterParticle : public CParticle
{
public:
	CWaterParticle();
	~CWaterParticle();

	HRESULT Init(void);
	void Update(void);

private:

};

//*****************************************************************************
// オーラパーティクルクラス
//*****************************************************************************
class CAuraParticle : public CParticle
{
public:
	CAuraParticle();
	~CAuraParticle();

	HRESULT Init(void);
	void Update(void);

private:

};

//*****************************************************************************
// オーラ(仮面用)パーティクルクラス
//*****************************************************************************
class CAura2Particle : public CParticle
{
public:
	CAura2Particle();
	~CAura2Particle();

	HRESULT Init(void);
	void Update(void);

private:

};

//*****************************************************************************
// 移動時パーティクルクラス
//*****************************************************************************
class CMoveParticle : public CParticle
{
public:
	CMoveParticle();
	~CMoveParticle();

	HRESULT Init(void);
	void Update(void);

private:

};

#endif